---
- name: Install Packages and Configure macOS
  hosts: localhost
  become: yes

  vars:
    package_list_path: "./packages.txt"
    neovim_config_repo: "https://github.com/W-Kanzashi/nvim.git"
    neovim_config_dest: "~/.config/nvim"
    applications_folder: "/Applications"

  tasks:
    - name: Setup Homebrew and install packages
      include_tasks: tasks/homebrew.yml
      when: ansible_os_family == "Darwin"

    - name: Decrypt vault and deploy configurations
      include_tasks: tasks/vault.yml
      when: ansible_os_family == "Darwin"

    - name: Setup development tools
      include_tasks: tasks/devtools.yml
      when: ansible_os_family == "Darwin"

    - name: Configure applications
      include_tasks: tasks/apps.yml
      when: ansible_os_family == "Darwin"

    - name: Apply macOS system preferences
      include_tasks: macos.yml
      when: ansible_os_family == "Darwin"
